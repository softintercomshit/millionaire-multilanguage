{% extends 'bootstrap4/bootstrap4.html' %}

{% load bootstrap4 %}

{% block bootstrap4_extra_head %}
    <head>
        <title>{{ object.display_name }}</title>
    </head>
    {% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'appadmin/style.css' %}"/>
{% endblock %}

{% block bootstrap4_content %}

    <div class="container" style="padding-left: 10%; padding-right: 10%;">
        <div class="row">
            <div class="col">
                <div class="card card-succes">
                    <div class="card-header bg-warning" align="center" style="font-size: x-large;">
                        <a href="{% url 'appadmin:bundle_detail' pk=object.id %}">{{ object.display_name }}</a>
                    </div>
                    <div class="row">
                        <div class="col-sm" style="height: 50px;">
                            <button type="button" class="btn btn-primary btn-lg" style="height: 100%;"
                                    onclick="openAddQuestion();">Add question
                                <i class="glyphicon glyphicon-plus"></i>
                            </button>
                            <button type="button" class="btn btn-info btn-lg" style="height: 100%;"
                                    onclick="openStatistics();">Statistics
                                <i class="glyphicon glyphicon-stats"></i>
                            </button>
                            <button type="button" class="btn btn-danger btn-lg" style="height: 100%;"
                                    onclick="openBugReports();">Bug reports
                                <i class="glyphicon glyphicon-warning-sign"></i>
                            </button>
                        </div>
                        <div class="col-sm" style="height: 50px;">
                            <div id="custom-search-input" style="height: 100%;">
                                <div class="input-group col-md-12" style="height: 100%;">
                                    <input type="text" class="form-control input-lg" placeholder="Search"
                                           id="searchinputid" onkeydown="if(event.keyCode==13)openSearch();"
                                           style="font-size: 200%;"/>
                                    <span class="input-group-btn">
                                        <button class="btn btn-info btn-lg" type="button" style="width: 50px"
                                                onclick="openSearch();">
                                            <i class="glyphicon glyphicon-search"></i>
                                        </button>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col">
                <div align="left" style="padding-top: 20px;">
                    <table class="table table-striped">
                        <thead class="thead-dark">
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Delete</th>
                            <th scope="col">Question</th>
                            <th scope="col">Difficulty</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for question in questions %}
                            <tr>
                                <td align="left">{{ forloop.counter }}</td>
                                <td align="center">
                                    <button type="button" class="btn btn-danger btn-lg" style="height: 100%;"
                                            onclick="onDelete({{ question.id }});">Delete
                                        <i class="glyphicon glyphicon-remove"></i>
                                    </button>
                                </td>
                                <td>
                                    <a href="{% url 'appadmin:question_edit' pk=question.id %}"
                                       style="font-size: x-large">
                                        {{ question.label }}
                                    </a>
                                </td>
                                <td align="right" style="font-weight: bold; font-size: 150%;">{{ question.difficulty.level }}</td>
                            </tr>
                        {% empty %}
                            <tr>
                                <td></td>
                                <td><h1>No data</h1></td>
                                <td></td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col">
                <nav aria-label="Pagination">
                    <ul class="pagination justify-content-left pagination-lg" id="ulpagination">
                        {% if current_page <= 1 %}
                            <li class="page-item disabled">
                                <a class="page-link" aria-label="Previous">
                                    <span aria-hidden="true">&laquo;</span>
                                    <span class="sr-only">Previous</span>
                                </a>
                            </li>
                        {% else %}
                            <li class="page-item">
                                <a class="page-link" aria-label="Previous"
                                   onclick="onPageClick({{ current_page }} - 1)">
                                    <span aria-hidden="true">&laquo;</span>
                                    <span class="sr-only">Previous</span>
                                </a>
                            </li>
                        {% endif %}

                        {% for i in pages %}
                            {% if current_page == forloop.counter %}
                                <li class="page-item active">
                                    <a class="page-link">{{ forloop.counter }}</a>
                                </li>
                            {% else %}
                                <li class="page-item">
                                    <a class="page-link"
                                       onclick="onPageClick({{ forloop.counter }});">{{ forloop.counter }}
                                    </a>
                                </li>
                            {% endif %}
                        {% endfor %}

                        {% if current_page >= pages|length %}
                            <a class="page-link disabled" aria-label="Next">
                                <span aria-hidden="true">&raquo;</span>
                                <span class="sr-only">Next</span>
                            </a>
                        {% else %}
                            <li class="page-item">
                                <a class="page-link" aria-label="Next"
                                   onclick="onPageClick({{ current_page }} + 1)">
                                    <span aria-hidden="true">&raquo;</span>
                                    <span class="sr-only">Next</span>
                                </a>
                            </li>
                        {% endif %}
                    </ul>
                </nav>
            </div>
        </div>

    </div>

    <script>
        function openAddQuestion() {
            var url = '{% url 'appadmin:add_question_form' pk=object.id %}';
            window.open(url);
        }

        function openStatistics() {

        };

        function openBugReports() {

        };

        function onPageClick(page) {
            console.log(page);
            var url = window.location.href;
            $.urlParam = function (name) {
                var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(url);
                if (results == null) {
                    return null;
                }
                else {
                    return decodeURI(results[1]) || 0;
                }
            }

            var query_param = $.urlParam('q');
            if (query_param) {
                url = '{% url 'appadmin:bundle_detail' pk=object.id %}';
                url = url + '?q=' + query_param + '&page=' + page;
            } else {
                url = '{% url 'appadmin:bundle_detail' pk=object.id %}';
                url = url + '?page=' + page;
            }

            location.href = url;
        }

        function openSearch() {
            var text = $('#searchinputid').val();
            var url = '{% url 'appadmin:bundle_detail' pk=object.id %}';
            url = url + '?q=' + text;
            location.href = url;
        }

        function onDelete(question_id) {
            var url = '{% url 'appadmin:bundle_detail' pk=object.id %}';
            $.ajax({
                type: "get",
                url: url,
                dataType: 'json',
                data: {'delete': question_id},
                success: function (data) {
                    location.reload();
                },
                error: function (error) {
                    location.reload();
                }
            });
        }
    </script>

    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css" rel="stylesheet">

    <script>

    </script>

{% endblock %}
